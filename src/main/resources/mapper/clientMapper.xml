<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="Client">

    <resultMap id="clientProductMap" type="map">
        <result property="clientId" column="clientId"/>
        <result property="clientName" column="clientName"/>
        <result property="productId" column="productId"/>
        <result property="productName" column="productName"/>
        <result property="price" column="price"/>
    </resultMap>

    <!-- 거래처별 상품 조회 -->
    <select id="findClientsWithProducts" resultMap="clientProductMap">
        SELECT
        c.clientId,
        c.clientName,
        p.productId,
        p.description AS productName,
        p.price
        FROM client c
        JOIN client_product cp ON c.clientId = cp.clientId
        JOIN product p ON cp.productId = p.productId
        WHERE p.categoryId = 3
        ORDER BY c.clientName, p.description
    </select>

    <!-- 모든 거래처 조회 (기존 기능 유지) -->
    <select id="selectAllClients" resultType="map">
        SELECT clientId, clientName
        FROM client
        ORDER BY clientName
    </select>

</mapper>
